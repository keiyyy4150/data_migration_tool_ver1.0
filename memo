mod MappingHelper最下部


'==============================
' ベーステーブル選定（キー定義が成立している最初のテーブル。無ければ先頭）
'  - tblNames : H列以降のテーブル名配列 Map_TblNames()
'  - srcCols  : マッピングの元カラム   Map_SrcCols(行=出力列, 列=テーブル)
'  - isKey    : キー列フラグ配列       Map_IsKey()
' 返り値      : ベーステーブル名（空配列時は ""）
'==============================
Public Function PickBaseTableName(tblNames() As String, srcCols As Variant, isKey() As Boolean) As String
    Dim t As Long, i As Long
    ' テーブル名が未設定なら空を返す
    If (Not Not tblNames) = 0 Then
        PickBaseTableName = ""
        Exit Function
    End If
    
    ' どれか1つでも「キー=○」かつ該当テーブルに元カラムが指定されている最初のテーブルを採用
    For t = LBound(tblNames) To UBound(tblNames)
        For i = LBound(isKey) To UBound(isKey)
            If isKey(i) Then
                ' srcCols(行=i, 列=t) が範囲内か確認
                If (Not IsEmpty(srcCols)) Then
                    On Error Resume Next
                    Dim hasCol As Boolean
                    hasCol = (Len(Trim$(CStr(srcCols(i, t)))) > 0)
                    On Error GoTo 0
                    If hasCol Then
                        PickBaseTableName = tblNames(t)
                        Exit Function
                    End If
                End If
            End If
        Next i
    Next t
    
    ' 上で見つからなければ、先頭を採用
    PickBaseTableName = tblNames(LBound(tblNames))
End Function